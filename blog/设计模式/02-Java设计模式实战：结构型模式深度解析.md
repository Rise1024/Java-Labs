---
title: Javaè®¾è®¡æ¨¡å¼å®æˆ˜ï¼šç»“æ„å‹æ¨¡å¼æ·±åº¦è§£æ
description: æ·±å…¥è§£æJavaç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼ŒåŒ…æ‹¬é€‚é…å™¨ã€è£…é¥°å™¨ã€ä»£ç†ç­‰æ¨¡å¼çš„å®ç°åŸç†å’Œæœ€ä½³å®è·µ
tags: [Java, è®¾è®¡æ¨¡å¼, ç»“æ„å‹æ¨¡å¼, é€‚é…å™¨æ¨¡å¼, è£…é¥°å™¨æ¨¡å¼, ä»£ç†æ¨¡å¼]
category: è®¾è®¡æ¨¡å¼
date: 2025-09-26
---

# Javaè®¾è®¡æ¨¡å¼å®æˆ˜ï¼šç»“æ„å‹æ¨¡å¼æ·±åº¦è§£æ

## ğŸ¯ å¼•è¨€

ç»“æ„å‹æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œæè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡ç»“åˆåœ¨ä¸€èµ·å½¢æˆæ›´å¤§çš„ç»“æ„ã€‚è¿™äº›æ¨¡å¼é€šè¿‡åˆç†çš„ç»„åˆæ¥å®ç°æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¿æŒç»“æ„çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚

æœ¬æ–‡å°†æ·±å…¥è§£ææœ€é‡è¦çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œç»“åˆç°ä»£Javaå¼€å‘å®è·µï¼Œæä¾›å¯ç›´æ¥åº”ç”¨äºç”Ÿäº§ç¯å¢ƒçš„è§£å†³æ–¹æ¡ˆã€‚

## ğŸ“š ç»“æ„å‹æ¨¡å¼æ¦‚è¿°

ç»“æ„å‹æ¨¡å¼ä¸»è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š
- **æ¥å£ä¸å…¼å®¹** - é€šè¿‡é€‚é…å™¨è¿æ¥ä¸å…¼å®¹çš„æ¥å£
- **åŠŸèƒ½æ‰©å±•** - åœ¨ä¸ä¿®æ”¹åŸç±»çš„æƒ…å†µä¸‹å¢åŠ æ–°åŠŸèƒ½
- **è®¿é—®æ§åˆ¶** - æ§åˆ¶å¯¹è±¡çš„è®¿é—®æ–¹å¼å’Œæƒé™
- **ç»“æ„ç®€åŒ–** - ä¸ºå¤æ‚çš„å­ç³»ç»Ÿæä¾›ç®€å•çš„æ¥å£

### ç»“æ„å‹æ¨¡å¼åˆ†ç±»

| æ¨¡å¼åç§° | ä¸»è¦ç›®çš„ | é€‚ç”¨åœºæ™¯ | å¤æ‚åº¦ |
|---------|---------|---------|-------|
| **é€‚é…å™¨æ¨¡å¼** | æ¥å£è½¬æ¢ | æ•´åˆç¬¬ä¸‰æ–¹åº“ã€é—ç•™ç³»ç»Ÿé›†æˆ | â­â­â­ |
| **è£…é¥°å™¨æ¨¡å¼** | åŠ¨æ€æ‰©å±•åŠŸèƒ½ | åŠŸèƒ½ç»„åˆã€ä¸­é—´ä»¶ã€AOP | â­â­â­â­ |
| **ä»£ç†æ¨¡å¼** | æ§åˆ¶è®¿é—® | ç¼“å­˜ã€æƒé™æ§åˆ¶ã€å»¶è¿ŸåŠ è½½ | â­â­â­â­ |
| **å¤–è§‚æ¨¡å¼** | ç®€åŒ–æ¥å£ | APIç½‘å…³ã€ç»Ÿä¸€å…¥å£ | â­â­ |
| **æ¡¥æ¥æ¨¡å¼** | åˆ†ç¦»æŠ½è±¡å’Œå®ç° | è·¨å¹³å°å¼€å‘ã€é©±åŠ¨ç¨‹åº | â­â­â­â­â­ |
| **ç»„åˆæ¨¡å¼** | æ ‘å½¢ç»“æ„ | æ–‡ä»¶ç³»ç»Ÿã€ç»„ç»‡æ¶æ„ | â­â­â­â­ |
| **äº«å…ƒæ¨¡å¼** | å…±äº«å¯¹è±¡ | ç¼“å­˜ã€å¯¹è±¡æ±  | â­â­â­â­â­ |

## ğŸ”Œ é€‚é…å™¨æ¨¡å¼è¯¦è§£

### æ¨¡å¼å®šä¹‰

å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚

### å®ç°æ–¹å¼

#### 1. å¯¹è±¡é€‚é…å™¨ï¼ˆæ¨èï¼‰

ä½¿ç”¨ç»„åˆçš„æ–¹å¼ï¼Œæ›´çµæ´»ä¸”ç¬¦åˆ"ç»„åˆä¼˜äºç»§æ‰¿"çš„åŸåˆ™ã€‚

```java
// ç›®æ ‡æ¥å£ - å®¢æˆ·ç«¯æœŸæœ›çš„æ¥å£
public interface Target {
    String request(String data);
}

// è¢«é€‚é…è€… - éœ€è¦é€‚é…çš„ç°æœ‰ç±»
@Slf4j
public class Adaptee {
    public String specificRequest(String input) {
        String result = "Adapteeå¤„ç†: " + input.toUpperCase();
        log.info("è¢«é€‚é…è€…å¤„ç†è¯·æ±‚: {} -> {}", input, result);
        return result;
    }
}

// å¯¹è±¡é€‚é…å™¨
@Slf4j
@AllArgsConstructor
public class ObjectAdapter implements Target {
    private final Adaptee adaptee;
    
    @Override
    public String request(String data) {
        log.info("å¯¹è±¡é€‚é…å™¨è½¬æ¢è¯·æ±‚: {}", data);
        // å°†Targetæ¥å£çš„è°ƒç”¨è½¬æ¢ä¸ºAdapteeçš„è°ƒç”¨
        return adaptee.specificRequest(data);
    }
}
```

#### 2. ç±»é€‚é…å™¨

ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼ï¼Œåœ¨Javaä¸­ç”±äºå•ç»§æ‰¿é™åˆ¶ï¼Œä½¿ç”¨è¾ƒå°‘ã€‚

```java
@Slf4j
public class ClassAdapter extends Adaptee implements Target {
    @Override
    public String request(String data) {
        log.info("ç±»é€‚é…å™¨è½¬æ¢è¯·æ±‚: {}", data);
        return specificRequest(data);
    }
}
```

### å®é™…åº”ç”¨åœºæ™¯

#### 1. ç¬¬ä¸‰æ–¹åº“é›†æˆ

```java
// ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£
public interface ThirdPartyPayment {
    PaymentResult processPayment(String amount, String currency);
}

// æˆ‘ä»¬çš„ç»Ÿä¸€æ”¯ä»˜æ¥å£
public interface PaymentService {
    boolean pay(double amount, String currency);
}

// é€‚é…å™¨å®ç°
@Slf4j
@AllArgsConstructor
public class PaymentAdapter implements PaymentService {
    private final ThirdPartyPayment thirdPartyPayment;
    
    @Override
    public boolean pay(double amount, String currency) {
        log.info("é€‚é…å™¨å¤„ç†æ”¯ä»˜è¯·æ±‚: {} {}", amount, currency);
        
        try {
            PaymentResult result = thirdPartyPayment.processPayment(
                String.valueOf(amount), currency);
            return result.isSuccess();
        } catch (Exception e) {
            log.error("æ”¯ä»˜å¤„ç†å¤±è´¥", e);
            return false;
        }
    }
}
```

#### 2. æ•°æ®æ ¼å¼è½¬æ¢

```java
// ç°æœ‰çš„JSONå¤„ç†å™¨
public class JsonProcessor {
    public String processJson(String json) {
        // JSONå¤„ç†é€»è¾‘
        return json.toUpperCase();
    }
}

// éœ€è¦XMLå¤„ç†èƒ½åŠ›
public interface XmlProcessor {
    String processXml(String xml);
}

// XMLåˆ°JSONé€‚é…å™¨
@AllArgsConstructor
public class XmlToJsonAdapter implements XmlProcessor {
    private final JsonProcessor jsonProcessor;
    
    @Override
    public String processXml(String xml) {
        // å°†XMLè½¬æ¢ä¸ºJSON
        String json = convertXmlToJson(xml);
        // ä½¿ç”¨ç°æœ‰çš„JSONå¤„ç†å™¨
        String processedJson = jsonProcessor.processJson(json);
        // è½¬æ¢å›XML
        return convertJsonToXml(processedJson);
    }
    
    private String convertXmlToJson(String xml) {
        // XMLåˆ°JSONçš„è½¬æ¢é€»è¾‘
        return "{}"; // ç®€åŒ–å®ç°
    }
    
    private String convertJsonToXml(String json) {
        // JSONåˆ°XMLçš„è½¬æ¢é€»è¾‘
        return "<root></root>"; // ç®€åŒ–å®ç°
    }
}
```

## ğŸ¨ è£…é¥°å™¨æ¨¡å¼è¯¦è§£

### æ¨¡å¼å®šä¹‰

åŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼Œå°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°å™¨æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ã€‚

### æ ¸å¿ƒå®ç°

```java
// ç»„ä»¶æ¥å£
public interface Component {
    String operation();
    double getCost();
}

// å…·ä½“ç»„ä»¶ - åŸºç¡€å’–å•¡
@Slf4j
public class ConcreteComponent implements Component {
    @Override
    public String operation() {
        String result = "åŸºç¡€å’–å•¡";
        log.info("åˆ¶ä½œ: {}", result);
        return result;
    }
    
    @Override
    public double getCost() {
        return 10.0;
    }
}

// æŠ½è±¡è£…é¥°å™¨
@AllArgsConstructor
public abstract class BaseDecorator implements Component {
    protected final Component component;
    
    @Override
    public String operation() {
        return component.operation();
    }
    
    @Override
    public double getCost() {
        return component.getCost();
    }
}

// å…·ä½“è£…é¥°å™¨ - ç‰›å¥¶è£…é¥°å™¨
@Slf4j
public class MilkDecorator extends BaseDecorator {
    public MilkDecorator(Component component) {
        super(component);
    }
    
    @Override
    public String operation() {
        String result = super.operation() + " + ç‰›å¥¶";
        log.info("æ·»åŠ ç‰›å¥¶è£…é¥°: {}", result);
        return result;
    }
    
    @Override
    public double getCost() {
        return super.getCost() + 2.0;
    }
}
```

### ä¼ä¸šçº§åº”ç”¨åœºæ™¯

#### 1. Webè¯·æ±‚å¤„ç†ç®¡é“

```java
// HTTPè¯·æ±‚å¤„ç†æ¥å£
public interface RequestHandler {
    Response handle(Request request);
}

// åŸºç¡€å¤„ç†å™¨
public class BaseRequestHandler implements RequestHandler {
    @Override
    public Response handle(Request request) {
        return new Response("åŸºç¡€å¤„ç†å®Œæˆ");
    }
}

// è®¤è¯è£…é¥°å™¨
@Slf4j
public class AuthenticationDecorator extends BaseDecorator {
    public AuthenticationDecorator(RequestHandler handler) {
        super(handler);
    }
    
    @Override
    public Response handle(Request request) {
        log.info("æ‰§è¡Œèº«ä»½è®¤è¯");
        
        if (!isAuthenticated(request)) {
            return new Response("è®¤è¯å¤±è´¥", 401);
        }
        
        return super.handle(request);
    }
    
    private boolean isAuthenticated(Request request) {
        // è®¤è¯é€»è¾‘
        return request.getHeader("Authorization") != null;
    }
}

// æ—¥å¿—è£…é¥°å™¨
@Slf4j
public class LoggingDecorator extends BaseDecorator {
    public LoggingDecorator(RequestHandler handler) {
        super(handler);
    }
    
    @Override
    public Response handle(Request request) {
        long startTime = System.currentTimeMillis();
        log.info("å¼€å§‹å¤„ç†è¯·æ±‚: {}", request.getPath());
        
        try {
            Response response = super.handle(request);
            long duration = System.currentTimeMillis() - startTime;
            log.info("è¯·æ±‚å¤„ç†å®Œæˆ: {} - è€—æ—¶: {}ms", 
                    request.getPath(), duration);
            return response;
        } catch (Exception e) {
            log.error("è¯·æ±‚å¤„ç†å¤±è´¥: {}", request.getPath(), e);
            throw e;
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class RequestProcessingDemo {
    public static void main(String[] args) {
        RequestHandler handler = new LoggingDecorator(
            new AuthenticationDecorator(
                new BaseRequestHandler()
            )
        );
        
        Request request = new Request("/api/users");
        Response response = handler.handle(request);
    }
}
```

#### 2. æ•°æ®ç¼“å­˜è£…é¥°å™¨

```java
// æ•°æ®æœåŠ¡æ¥å£
public interface DataService {
    String getData(String key);
    void saveData(String key, String data);
}

// åŸºç¡€æ•°æ®æœåŠ¡
@Slf4j
public class DatabaseDataService implements DataService {
    @Override
    public String getData(String key) {
        log.info("ä»æ•°æ®åº“è·å–æ•°æ®: {}", key);
        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
        return "æ•°æ®åº“æ•°æ®: " + key;
    }
    
    @Override
    public void saveData(String key, String data) {
        log.info("ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“: {} = {}", key, data);
    }
}

// ç¼“å­˜è£…é¥°å™¨
@Slf4j
public class CacheDecorator implements DataService {
    private final DataService dataService;
    private final Map<String, String> cache = new ConcurrentHashMap<>();
    
    public CacheDecorator(DataService dataService) {
        this.dataService = dataService;
    }
    
    @Override
    public String getData(String key) {
        // å…ˆæŸ¥ç¼“å­˜
        String cachedData = cache.get(key);
        if (cachedData != null) {
            log.info("ä»ç¼“å­˜è·å–æ•°æ®: {}", key);
            return cachedData;
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
        String data = dataService.getData(key);
        cache.put(key, data);
        log.info("æ•°æ®å·²ç¼“å­˜: {}", key);
        
        return data;
    }
    
    @Override
    public void saveData(String key, String data) {
        dataService.saveData(key, data);
        cache.put(key, data); // æ›´æ–°ç¼“å­˜
    }
}
```

## ğŸ›¡ï¸ ä»£ç†æ¨¡å¼è¯¦è§£

### æ¨¡å¼å®šä¹‰

ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚

### ä»£ç†ç±»å‹

1. **è™šæ‹Ÿä»£ç†** - å»¶è¿Ÿåˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡
2. **ä¿æŠ¤ä»£ç†** - æ§åˆ¶å¯¹åŸå¯¹è±¡çš„è®¿é—®æƒé™
3. **æ™ºèƒ½ä»£ç†** - åœ¨è®¿é—®å¯¹è±¡æ—¶æ‰§è¡Œä¸€äº›é™„åŠ æ“ä½œ

### æ ¸å¿ƒå®ç°

```java
// ä¸»é¢˜æ¥å£
public interface Subject {
    String request(String request);
}

// çœŸå®ä¸»é¢˜
@Slf4j
public class RealSubject implements Subject {
    @Override
    public String request(String request) {
        log.info("çœŸå®ä¸»é¢˜å¤„ç†è¯·æ±‚: {}", request);
        
        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        
        return "çœŸå®å¤„ç†ç»“æœ: " + request.toUpperCase();
    }
}

// ä»£ç†ç±»
@Slf4j
public class Proxy implements Subject {
    private RealSubject realSubject;
    private final Map<String, String> cache = new HashMap<>();
    
    @Override
    public String request(String request) {
        log.info("ä»£ç†æ¥æ”¶è¯·æ±‚: {}", request);
        
        // 1. é¢„å¤„ç† - æƒé™æ£€æŸ¥
        if (!checkAccess(request)) {
            return "è®¿é—®è¢«æ‹’ç»: " + request;
        }
        
        // 2. ç¼“å­˜æ£€æŸ¥
        if (cache.containsKey(request)) {
            String cachedResult = cache.get(request);
            log.info("ä»ç¼“å­˜è¿”å›ç»“æœ: {}", cachedResult);
            return cachedResult;
        }
        
        // 3. å»¶è¿Ÿåˆå§‹åŒ–çœŸå®å¯¹è±¡
        if (realSubject == null) {
            log.info("å»¶è¿Ÿåˆ›å»ºçœŸå®ä¸»é¢˜å¯¹è±¡");
            realSubject = new RealSubject();
        }
        
        // 4. è°ƒç”¨çœŸå®å¯¹è±¡
        String result = realSubject.request(request);
        
        // 5. åå¤„ç† - ç¼“å­˜ç»“æœ
        cache.put(request, result);
        log.info("ç¼“å­˜å¤„ç†ç»“æœ: {}", request);
        
        return result;
    }
    
    private boolean checkAccess(String request) {
        boolean allowed = !request.contains("forbidden");
        log.info("æƒé™æ£€æŸ¥ [{}]: {}", request, allowed ? "å…è®¸" : "æ‹’ç»");
        return allowed;
    }
}
```

### åŠ¨æ€ä»£ç†åº”ç”¨

Javaæä¾›äº†åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†å¯¹è±¡ã€‚

#### 1. JDKåŠ¨æ€ä»£ç†

```java
// æ€§èƒ½ç›‘æ§ä»£ç†
@Slf4j
public class PerformanceInvocationHandler implements InvocationHandler {
    private final Object target;
    
    public PerformanceInvocationHandler(Object target) {
        this.target = target;
    }
    
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) 
            throws Throwable {
        long startTime = System.currentTimeMillis();
        
        try {
            Object result = method.invoke(target, args);
            long duration = System.currentTimeMillis() - startTime;
            
            log.info("æ–¹æ³• {} æ‰§è¡Œè€—æ—¶: {}ms", method.getName(), duration);
            
            return result;
        } catch (Exception e) {
            log.error("æ–¹æ³• {} æ‰§è¡Œå¤±è´¥", method.getName(), e);
            throw e;
        }
    }
    
    @SuppressWarnings("unchecked")
    public static <T> T createProxy(T target, Class<T> interfaceType) {
        return (T) Proxy.newProxyInstance(
            interfaceType.getClassLoader(),
            new Class[]{interfaceType},
            new PerformanceInvocationHandler(target)
        );
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class DynamicProxyDemo {
    public static void main(String[] args) {
        // åˆ›å»ºçœŸå®å¯¹è±¡
        DataService realService = new DatabaseDataService();
        
        // åˆ›å»ºä»£ç†å¯¹è±¡
        DataService proxyService = PerformanceInvocationHandler
            .createProxy(realService, DataService.class);
        
        // é€šè¿‡ä»£ç†è°ƒç”¨æ–¹æ³•
        String data = proxyService.getData("test");
        log.info("è·å–åˆ°æ•°æ®: {}", data);
    }
}
```

#### 2. CGLIBåŠ¨æ€ä»£ç†

é€‚ç”¨äºæ²¡æœ‰æ¥å£çš„ç±»ï¼Œé€šè¿‡å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯åˆ›å»ºå­ç±»ä»£ç†ã€‚

```java
@Slf4j
public class CglibMethodInterceptor implements MethodInterceptor {
    
    @Override
    public Object intercept(Object obj, Method method, Object[] args, 
                          MethodProxy proxy) throws Throwable {
        log.info("CGLIBä»£ç† - æ–¹æ³•è°ƒç”¨å‰: {}", method.getName());
        
        Object result = proxy.invokeSuper(obj, args);
        
        log.info("CGLIBä»£ç† - æ–¹æ³•è°ƒç”¨å: {}", method.getName());
        
        return result;
    }
    
    @SuppressWarnings("unchecked")
    public static <T> T createProxy(Class<T> clazz) {
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(clazz);
        enhancer.setCallback(new CglibMethodInterceptor());
        
        return (T) enhancer.create();
    }
}
```

### ä¼ä¸šçº§ä»£ç†åº”ç”¨

#### 1. åˆ†å¸ƒå¼æœåŠ¡ä»£ç†

```java
// è¿œç¨‹æœåŠ¡æ¥å£
public interface RemoteService {
    String callRemoteApi(String request);
}

// è¿œç¨‹æœåŠ¡ä»£ç†
@Slf4j
public class RemoteServiceProxy implements RemoteService {
    private final String serviceUrl;
    private final RestTemplate restTemplate;
    private final CircuitBreaker circuitBreaker;
    
    public RemoteServiceProxy(String serviceUrl) {
        this.serviceUrl = serviceUrl;
        this.restTemplate = new RestTemplate();
        this.circuitBreaker = CircuitBreaker.ofDefaults("remoteService");
    }
    
    @Override
    public String callRemoteApi(String request) {
        return circuitBreaker.executeSupplier(() -> {
            try {
                log.info("è°ƒç”¨è¿œç¨‹æœåŠ¡: {}", serviceUrl);
                
                // æœåŠ¡å‘ç°
                String actualUrl = discoverService(serviceUrl);
                
                // è´Ÿè½½å‡è¡¡
                String selectedUrl = loadBalance(actualUrl);
                
                // å‘èµ·HTTPè¯·æ±‚
                return restTemplate.postForObject(
                    selectedUrl, request, String.class);
                    
            } catch (Exception e) {
                log.error("è¿œç¨‹æœåŠ¡è°ƒç”¨å¤±è´¥", e);
                throw new RuntimeException("æœåŠ¡ä¸å¯ç”¨", e);
            }
        });
    }
    
    private String discoverService(String serviceName) {
        // æœåŠ¡å‘ç°é€»è¾‘
        return "http://actual-service:8080/api";
    }
    
    private String loadBalance(String baseUrl) {
        // è´Ÿè½½å‡è¡¡é€»è¾‘
        return baseUrl;
    }
}
```

#### 2. æ•°æ®åº“è¿æ¥ä»£ç†

```java
// æ•°æ®åº“è¿æ¥ä»£ç† - å®ç°è¿æ¥æ± å’Œäº‹åŠ¡ç®¡ç†
@Slf4j
public class ConnectionProxy implements Connection {
    private final Connection realConnection;
    private final ConnectionPool connectionPool;
    private boolean closed = false;
    
    public ConnectionProxy(Connection realConnection, 
                          ConnectionPool connectionPool) {
        this.realConnection = realConnection;
        this.connectionPool = connectionPool;
    }
    
    @Override
    public void close() throws SQLException {
        if (!closed) {
            log.info("å½’è¿˜è¿æ¥åˆ°è¿æ¥æ± ");
            connectionPool.returnConnection(this);
            closed = true;
        }
    }
    
    @Override
    public PreparedStatement prepareStatement(String sql) throws SQLException {
        log.info("é¢„ç¼–è¯‘SQL: {}", sql);
        return realConnection.prepareStatement(sql);
    }
    
    @Override
    public void commit() throws SQLException {
        log.info("æäº¤äº‹åŠ¡");
        realConnection.commit();
    }
    
    @Override
    public void rollback() throws SQLException {
        log.info("å›æ»šäº‹åŠ¡");
        realConnection.rollback();
    }
    
    // å…¶ä»–Connectionæ–¹æ³•çš„å§”æ‰˜å®ç°...
}
```

## ğŸ—ï¸ å…¶ä»–é‡è¦ç»“æ„å‹æ¨¡å¼

### å¤–è§‚æ¨¡å¼ï¼ˆFacade Patternï¼‰

æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ã€‚

```java
// å¤æ‚å­ç³»ç»Ÿ
@Slf4j
public class OrderSubsystem {
    public void createOrder(String orderId) {
        log.info("åˆ›å»ºè®¢å•: {}", orderId);
    }
}

@Slf4j
public class PaymentSubsystem {
    public boolean processPayment(String orderId, double amount) {
        log.info("å¤„ç†æ”¯ä»˜: {} - {}", orderId, amount);
        return true;
    }
}

@Slf4j
public class InventorySubsystem {
    public boolean reserveItems(String orderId, List<String> items) {
        log.info("é¢„ç•™åº“å­˜: {} - {}", orderId, items);
        return true;
    }
}

// å¤–è§‚ç±» - ç®€åŒ–å¤æ‚çš„å­ç³»ç»Ÿäº¤äº’
@Slf4j
@AllArgsConstructor
public class OrderFacade {
    private final OrderSubsystem orderSubsystem;
    private final PaymentSubsystem paymentSubsystem;
    private final InventorySubsystem inventorySubsystem;
    
    public boolean placeOrder(String orderId, List<String> items, double amount) {
        log.info("å¼€å§‹å¤„ç†è®¢å•: {}", orderId);
        
        try {
            // 1. åˆ›å»ºè®¢å•
            orderSubsystem.createOrder(orderId);
            
            // 2. é¢„ç•™åº“å­˜
            if (!inventorySubsystem.reserveItems(orderId, items)) {
                throw new RuntimeException("åº“å­˜ä¸è¶³");
            }
            
            // 3. å¤„ç†æ”¯ä»˜
            if (!paymentSubsystem.processPayment(orderId, amount)) {
                throw new RuntimeException("æ”¯ä»˜å¤±è´¥");
            }
            
            log.info("è®¢å•å¤„ç†æˆåŠŸ: {}", orderId);
            return true;
            
        } catch (Exception e) {
            log.error("è®¢å•å¤„ç†å¤±è´¥: {}", orderId, e);
            return false;
        }
    }
}
```

### ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰

å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º"éƒ¨åˆ†-æ•´ä½“"çš„å±‚æ¬¡ç»“æ„ã€‚

```java
// ç»„ä»¶æ¥å£
public interface FileSystemComponent {
    void display(int depth);
    long getSize();
    String getName();
}

// æ–‡ä»¶ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰
@AllArgsConstructor
@Getter
public class File implements FileSystemComponent {
    private final String name;
    private final long size;
    
    @Override
    public void display(int depth) {
        String indent = "  ".repeat(depth);
        System.out.println(indent + "ğŸ“„ " + name + " (" + size + " bytes)");
    }
    
    @Override
    public long getSize() {
        return size;
    }
}

// ç›®å½•ï¼ˆç»„åˆèŠ‚ç‚¹ï¼‰
@Getter
public class Directory implements FileSystemComponent {
    private final String name;
    private final List<FileSystemComponent> children = new ArrayList<>();
    
    public Directory(String name) {
        this.name = name;
    }
    
    public void add(FileSystemComponent component) {
        children.add(component);
    }
    
    public void remove(FileSystemComponent component) {
        children.remove(component);
    }
    
    @Override
    public void display(int depth) {
        String indent = "  ".repeat(depth);
        System.out.println(indent + "ğŸ“ " + name + "/");
        
        for (FileSystemComponent child : children) {
            child.display(depth + 1);
        }
    }
    
    @Override
    public long getSize() {
        return children.stream()
                .mapToLong(FileSystemComponent::getSize)
                .sum();
    }
}
```

## ğŸš€ ç°ä»£Javaç‰¹æ€§çš„åº”ç”¨

### ä½¿ç”¨æ¥å£çš„é»˜è®¤æ–¹æ³•ç®€åŒ–è£…é¥°å™¨

```java
public interface EnhancedComponent {
    String process(String input);
    
    // é»˜è®¤çš„æ—¥å¿—è£…é¥°
    default EnhancedComponent withLogging() {
        return input -> {
            System.out.println("å¤„ç†è¾“å…¥: " + input);
            String result = this.process(input);
            System.out.println("å¤„ç†ç»“æœ: " + result);
            return result;
        };
    }
    
    // é»˜è®¤çš„ç¼“å­˜è£…é¥°
    default EnhancedComponent withCaching() {
        Map<String, String> cache = new ConcurrentHashMap<>();
        return input -> cache.computeIfAbsent(input, this::process);
    }
    
    // é»˜è®¤çš„æ€§èƒ½ç›‘æ§è£…é¥°
    default EnhancedComponent withPerformanceMonitoring() {
        return input -> {
            long start = System.currentTimeMillis();
            String result = this.process(input);
            long duration = System.currentTimeMillis() - start;
            System.out.println("å¤„ç†è€—æ—¶: " + duration + "ms");
            return result;
        };
    }
}

// ä½¿ç”¨ç¤ºä¾‹
EnhancedComponent component = input -> "å¤„ç†: " + input.toUpperCase();

EnhancedComponent enhancedComponent = component
    .withLogging()
    .withCaching()
    .withPerformanceMonitoring();
```

### ä½¿ç”¨å‡½æ•°å¼æ¥å£å®ç°è½»é‡çº§ä»£ç†

```java
@FunctionalInterface
public interface ServiceFunction<T, R> {
    R apply(T input) throws Exception;
}

public class FunctionalProxy {
    
    public static <T, R> ServiceFunction<T, R> withRetry(
            ServiceFunction<T, R> function, int maxRetries) {
        return input -> {
            Exception lastException = null;
            
            for (int i = 0; i <= maxRetries; i++) {
                try {
                    return function.apply(input);
                } catch (Exception e) {
                    lastException = e;
                    if (i < maxRetries) {
                        Thread.sleep(1000 * (i + 1)); // æŒ‡æ•°é€€é¿
                    }
                }
            }
            
            throw lastException;
        };
    }
    
    public static <T, R> ServiceFunction<T, R> withCircuitBreaker(
            ServiceFunction<T, R> function, int failureThreshold) {
        AtomicInteger failureCount = new AtomicInteger(0);
        AtomicLong lastFailureTime = new AtomicLong(0);
        
        return input -> {
            long currentTime = System.currentTimeMillis();
            
            // æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€
            if (failureCount.get() >= failureThreshold) {
                if (currentTime - lastFailureTime.get() < 60000) { // 1åˆ†é’Ÿç†”æ–­
                    throw new RuntimeException("æœåŠ¡ç†”æ–­ä¸­");
                } else {
                    failureCount.set(0); // é‡ç½®è®¡æ•°å™¨
                }
            }
            
            try {
                R result = function.apply(input);
                failureCount.set(0); // æˆåŠŸæ—¶é‡ç½®è®¡æ•°å™¨
                return result;
            } catch (Exception e) {
                failureCount.incrementAndGet();
                lastFailureTime.set(currentTime);
                throw e;
            }
        };
    }
}

// ä½¿ç”¨ç¤ºä¾‹
ServiceFunction<String, String> service = input -> {
    // å¯èƒ½å¤±è´¥çš„æœåŠ¡è°ƒç”¨
    if (Math.random() < 0.3) {
        throw new RuntimeException("æœåŠ¡è°ƒç”¨å¤±è´¥");
    }
    return "å¤„ç†ç»“æœ: " + input;
};

ServiceFunction<String, String> resilientService = 
    FunctionalProxy.withCircuitBreaker(
        FunctionalProxy.withRetry(service, 3), 
        5
    );
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ

### è£…é¥°å™¨æ¨¡å¼ä¼˜åŒ–

```java
// ä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ„å»ºè£…é¥°å™¨é“¾
public class DecoratorChainBuilder {
    private Component component;
    
    public DecoratorChainBuilder(Component component) {
        this.component = component;
    }
    
    public DecoratorChainBuilder addLogging() {
        this.component = new LoggingDecorator(component);
        return this;
    }
    
    public DecoratorChainBuilder addCaching() {
        this.component = new CachingDecorator(component);
        return this;
    }
    
    public DecoratorChainBuilder addAuthentication() {
        this.component = new AuthenticationDecorator(component);
        return this;
    }
    
    public Component build() {
        return component;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
Component decoratedComponent = new DecoratorChainBuilder(baseComponent)
    .addAuthentication()
    .addLogging()
    .addCaching()
    .build();
```

### ä»£ç†æ¨¡å¼æ€§èƒ½ä¼˜åŒ–

```java
// ä½¿ç”¨ThreadLocalä¼˜åŒ–ä»£ç†æ€§èƒ½
public class OptimizedProxy implements Subject {
    private final ThreadLocal<Subject> realSubjectHolder = new ThreadLocal<>();
    private final Subject sharedRealSubject;
    
    public OptimizedProxy() {
        this.sharedRealSubject = new RealSubject();
    }
    
    @Override
    public String request(String request) {
        // å¯¹äºçº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œä½¿ç”¨å…±äº«å®ä¾‹
        if (isThreadSafeOperation(request)) {
            return sharedRealSubject.request(request);
        }
        
        // å¯¹äºéçº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œä½¿ç”¨ThreadLocalå®ä¾‹
        Subject realSubject = realSubjectHolder.get();
        if (realSubject == null) {
            realSubject = new RealSubject();
            realSubjectHolder.set(realSubject);
        }
        
        return realSubject.request(request);
    }
    
    private boolean isThreadSafeOperation(String request) {
        // åˆ¤æ–­æ“ä½œæ˜¯å¦çº¿ç¨‹å®‰å…¨
        return request.startsWith("READ_");
    }
}
```

## ğŸ¯ æ¨¡å¼é€‰æ‹©æŒ‡å—

### å†³ç­–çŸ©é˜µ

| éœ€æ±‚åœºæ™¯ | æ¨èæ¨¡å¼ | å…³é”®è€ƒè™‘å› ç´  |
|---------|---------|-------------|
| æ•´åˆç¬¬ä¸‰æ–¹åº“ | é€‚é…å™¨æ¨¡å¼ | æ¥å£å…¼å®¹æ€§ |
| åŠ¨æ€æ·»åŠ åŠŸèƒ½ | è£…é¥°å™¨æ¨¡å¼ | åŠŸèƒ½ç»„åˆçµæ´»æ€§ |
| æ§åˆ¶å¯¹è±¡è®¿é—® | ä»£ç†æ¨¡å¼ | è®¿é—®æ§åˆ¶éœ€æ±‚ |
| ç®€åŒ–å¤æ‚æ¥å£ | å¤–è§‚æ¨¡å¼ | æ¥å£å¤æ‚åº¦ |
| æ ‘å½¢æ•°æ®ç»“æ„ | ç»„åˆæ¨¡å¼ | å±‚æ¬¡ç»“æ„éœ€æ±‚ |
| å¤§é‡ç›¸ä¼¼å¯¹è±¡ | äº«å…ƒæ¨¡å¼ | å†…å­˜ä½¿ç”¨æ•ˆç‡ |
| è·¨å¹³å°æŠ½è±¡ | æ¡¥æ¥æ¨¡å¼ | å¹³å°ç‹¬ç«‹æ€§ |

### åæ¨¡å¼è­¦å‘Š

1. **è¿‡åº¦è£…é¥°** - è£…é¥°å™¨å±‚æ¬¡è¿‡æ·±å½±å“æ€§èƒ½
2. **ä»£ç†æ»¥ç”¨** - ä¸å¿…è¦çš„ä»£ç†å¢åŠ å¤æ‚æ€§
3. **é€‚é…å™¨é“¾** - å¤šé‡é€‚é…å™¨è½¬æ¢é™ä½æ•ˆç‡

## ğŸ“ˆ æ€»ç»“

ç»“æ„å‹æ¨¡å¼æ˜¯æ„å»ºçµæ´»ã€å¯æ‰©å±•ç³»ç»Ÿçš„é‡è¦å·¥å…·ï¼š

1. **é€‚é…å™¨æ¨¡å¼** - è§£å†³æ¥å£ä¸å…¼å®¹é—®é¢˜
2. **è£…é¥°å™¨æ¨¡å¼** - å®ç°åŠŸèƒ½çš„åŠ¨æ€ç»„åˆ
3. **ä»£ç†æ¨¡å¼** - æä¾›è®¿é—®æ§åˆ¶å’Œå¢å¼ºåŠŸèƒ½
4. **å¤–è§‚æ¨¡å¼** - ç®€åŒ–å¤æ‚å­ç³»ç»Ÿçš„æ¥å£
5. **ç»„åˆæ¨¡å¼** - å¤„ç†æ ‘å½¢ç»“æ„æ•°æ®
6. **äº«å…ƒæ¨¡å¼** - ä¼˜åŒ–å†…å­˜ä½¿ç”¨
7. **æ¡¥æ¥æ¨¡å¼** - åˆ†ç¦»æŠ½è±¡å’Œå®ç°

### å…³é”®åŸåˆ™

- **ç»„åˆä¼˜äºç»§æ‰¿** - ä½¿ç”¨ç»„åˆå®ç°åŠŸèƒ½æ‰©å±•
- **å¼€é—­åŸåˆ™** - å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- **å•ä¸€èŒè´£** - æ¯ä¸ªè£…é¥°å™¨åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **æ€§èƒ½è€ƒè™‘** - é¿å…è¿‡åº¦åŒ…è£…å½±å“æ€§èƒ½

é€šè¿‡åˆç†åº”ç”¨ç»“æ„å‹æ¨¡å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ„å»ºå‡ºæ›´åŠ çµæ´»ã€å¯ç»´æŠ¤å’Œé«˜æ€§èƒ½çš„Javaåº”ç”¨ç¨‹åºã€‚

## ğŸ”— ç›¸å…³èµ„æº

- [é¡¹ç›®æºä»£ç ](https://github.com/Rise1024/Java-Labs/tree/main/java-design-patterns#readme)
- [Javaè®¾è®¡æ¨¡å¼ç³»åˆ—æ–‡ç« ](../README.md)
- [åˆ›å»ºå‹æ¨¡å¼è¯¦è§£](./01-Javaè®¾è®¡æ¨¡å¼å®æˆ˜ï¼šåˆ›å»ºå‹æ¨¡å¼æ·±åº¦è§£æ.md)
- [ç‰›é€¼çš„åšå®¢ç½‘ç«™](https://dongsheng.online)
